<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DiamondMiner | Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at top left, #0a0f1f, #09182e, #04111b);
      color: #fff;
      overflow-x: hidden;
      text-align: center;
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 40px;
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 255, 255, 0.3);
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.1);
    }
    nav a {
      color: #00ffff;
      text-decoration: none;
      margin: 0 18px;
      font-weight: 500;
      transition: 0.3s;
    }
    nav a:hover {
      color: #fff;
      text-shadow: 0 0 8px #00ffff;
    }

    .container {
      margin-top: 120px;
      padding: 30px;
    }

    h1 {
      color: #00ffff;
      text-shadow: 0 0 15px #00ffff;
      font-size: 2.2em;
      margin-bottom: 30px;
    }

    .balance {
      font-size: 1.5em;
      color: #fff;
      margin: 20px 0;
    }

    .balance span {
      color: #00ffff;
      font-weight: 600;
      text-shadow: 0 0 10px #00ffff;
    }

    button {
      background: linear-gradient(90deg, #00ffff, #0066ff);
      border: none;
      padding: 15px 40px;
      border-radius: 50px;
      color: #fff;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);
    }

    .status {
      margin-top: 20px;
      color: #00ffff;
      text-shadow: 0 0 10px #00ffff;
    }

    .hidden {
      display: none;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: -1;
    }
  </style>
</head>

<body>
  <nav>
    <div class="logo">üíé DiamondMiner</div>
    <div class="links">
      <a href="index.html">Home</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="tokenomics.html">Tokenomics</a>
      <a href="marketplace.html">Marketplace</a>
      <a href="whitepaper.html">Whitepaper</a>
    </div>
  </nav>

  <div class="container">
    <h1>Mining Dashboard</h1>
    <div class="balance">Mining Balance: <span id="balance">0.00</span> $DIA</div>
    <div class="balance">Total $DIA: <span id="total">0.00</span></div>
    <button id="startBtn">Start Mining</button>
    <div id="status" class="status hidden">‚õèÔ∏è Mining in progress...</div>
    <button id="disconnectBtn" class="hidden" style="margin-top:20px;">Disconnect Wallet</button>
  </div>

  <canvas id="bg"></canvas>

  <script>
    // Canvas animation (background sparkles)
    const canvas = document.getElementById("bg");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let sparkles = Array.from({ length: 80 }, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 2,
      s: Math.random() * 0.5 + 0.3
    }));

    function drawSparkles() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "rgba(0,255,255,0.8)";
      sparkles.forEach(s => {
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fill();
        s.y += s.s;
        if (s.y > canvas.height) s.y = 0;
      });
      requestAnimationFrame(drawSparkles);
    }
    drawSparkles();

    // --- Wallet + Mining Logic ---
    const balanceEl = document.getElementById("balance");
    const totalEl = document.getElementById("total");
    const startBtn = document.getElementById("startBtn");
    const disconnectBtn = document.getElementById("disconnectBtn");
    const miningStatus = document.getElementById("status");

    let mining = false, balance = 0, totalDia = 0, rate = 0.05, wallet = null;
    let lastMineTime = null, miningInterval = null;

    function saveData() {
      if (!wallet) return;
      const data = { balance, totalDia, mining, lastMineTime };
      localStorage.setItem(wallet + "_data", JSON.stringify(data));
    }

    function updateUI() {
      balanceEl.textContent = balance.toFixed(2);
      totalEl.textContent = (totalDia + balance).toFixed(2);
    }

    function startMining(resume = false) {
      mining = true;
      startBtn.innerText = "Stop Mining";
      miningStatus.classList.remove("hidden");
      disconnectBtn.classList.remove("hidden");
      lastMineTime = Date.now();
      saveData();

      clearInterval(miningInterval);
      miningInterval = setInterval(() => {
        const now = Date.now();
        const elapsedMinutes = (now - lastMineTime) / 60000;
        balance += elapsedMinutes * rate;
        lastMineTime = now;
        updateUI();
        saveData();
      }, 5000);
    }

    function stopMining() {
      if (!mining) return;
      const now = Date.now();
      const elapsedMinutes = (now - lastMineTime) / 60000;
      balance += elapsedMinutes * rate;
      mining = false;
      clearInterval(miningInterval);
      startBtn.innerText = "Start Mining";
      miningStatus.classList.add("hidden");
      saveData();
    }

    function disconnectWallet() {
      stopMining();
      wallet = null;
      localStorage.removeItem("connected_wallet");
      balance = 0;
      totalDia = 0;
      updateUI();
      disconnectBtn.classList.add("hidden");
      startBtn.innerText = "Start Mining";
      alert("Wallet disconnected.");
    }

    startBtn.addEventListener("click", () => {
      if (!wallet) {
        wallet = prompt("Enter wallet address to connect:");
        if (wallet) {
          localStorage.setItem("connected_wallet", wallet);
          const saved = JSON.parse(localStorage.getItem(wallet + "_data") || "{}");
          balance = saved.balance || 0;
          totalDia = saved.totalDia || 0;
          lastMineTime = saved.lastMineTime || null;
          const wasMining = saved.mining || false;

          if (wasMining && lastMineTime) {
            const now = Date.now();
            const elapsedMinutes = (now - lastMineTime) / 60000;
            const offlineEarned = elapsedMinutes * rate;
            balance += offlineEarned;
            lastMineTime = now;
            startMining(true);
          } else {
            startMining();
          }
          updateUI();
        }
      } else {
        if (mining) stopMining();
        else startMining();
      }
    });

    disconnectBtn.addEventListener("click", disconnectWallet);

    // Auto reconnect + continue mining
    window.addEventListener("load", () => {
      wallet = localStorage.getItem("connected_wallet");
      if (wallet) {
        const saved = JSON.parse(localStorage.getItem(wallet + "_data") || "{}");
        balance = saved.balance || 0;
        totalDia = saved.totalDia || 0;
        lastMineTime = saved.lastMineTime || null;
        const wasMining = saved.mining || false;

        if (wasMining && lastMineTime) {
          const now = Date.now();
          const elapsedMinutes = (now - lastMineTime) / 60000;
          const offlineEarned = elapsedMinutes * rate;
          balance += offlineEarned;
          lastMineTime = now;
          startMining(true);
        }
        updateUI();
        disconnectBtn.classList.remove("hidden");
      }
    });
  </script>
</body>
</html>
