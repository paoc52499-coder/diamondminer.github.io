<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DiamondMiner ‚Äì Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>

  <style>
    /* fade in/out */
    .fade-in { animation: fadeIn 0.6s ease-in-out forwards; }
    .fade-out { animation: fadeOut 0.6s ease-in-out forwards; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
    }
    .animate-float { animation: float 4s ease-in-out infinite; }

    /* Sparkle animation */
    .sparkle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: radial-gradient(circle, rgba(0,255,255,1) 0%, rgba(0,255,255,0) 70%);
      border-radius: 50%;
      opacity: 0;
      animation: sparkle 2s infinite ease-in-out;
      pointer-events: none;
      display: none;
      transform-origin: center;
      filter: drop-shadow(0 0 6px rgba(0,255,255,0.6));
    }
    @keyframes sparkle {
      0%, 100% { transform: scale(0.6); opacity: 0; }
      50% { transform: scale(1.3); opacity: 1; }
    }
    /* positions */
    .sparkle1 { top: 30%; left: 40%; animation-delay: 0s; }
    .sparkle2 { top: 50%; left: 60%; animation-delay: 0.6s; }
    .sparkle3 { top: 60%; left: 35%; animation-delay: 1.2s; }
    .sparkle4 { top: 40%; left: 55%; animation-delay: 1.8s; }

    /* active state when mining - makes sparkles visible and more intense */
    .sparkle-active {
      display: block !important;
      animation-duration: 1.2s !important;
      width: 12px !important;
      height: 12px !important;
      filter: drop-shadow(0 0 18px rgba(0,255,255,0.9)) !important;
    }

    /* subtle island glow when mining */
    .island-glow {
      box-shadow: 0 30px 80px rgba(34,211,238,0.25), 0 0 40px rgba(34,211,238,0.12);
      transform: translateY(-4px);
      transition: all 0.25s ease;
    }

    /* keep footer and layout consistent */
    footer { z-index: 10; position: relative; }
  </style>
</head>

<body class="bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900 text-white min-h-screen fade-in">
  <!-- NAVBAR -->
  <header class="fixed top-0 left-0 w-full bg-[#05060d]/90 backdrop-blur-sm z-50 border-b border-white/5">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-6 py-4">
      <a href="index.html" class="flex items-center gap-3">
        <img src="images/diamond-icon.png" alt="DiamondMiner" class="w-8 h-8 animate-pulse" />
        <span class="text-xl font-bold text-cyan-400">DiamondMiner</span>
      </a>

      <nav class="flex gap-8 text-sm font-medium">
        <a href="index.html" class="text-gray-300 hover:text-cyan-400 transition">Home</a>
        <a href="dashboard.html" class="text-gray-300 hover:text-cyan-400 transition">Dashboard</a>
        <a href="marketplace.html" class="text-gray-300 hover:text-cyan-400 transition">Marketplace</a>
        <a href="tokenomics.html" class="text-gray-300 hover:text-cyan-400 transition">Tokenomics</a>
        <a href="whitepaper.html" class="text-gray-300 hover:text-cyan-400 transition">Whitepaper</a>
      </nav>

      <!-- Disconnect Wallet button -->
      <div class="flex items-center gap-3">
        <button id="disconnectBtn" class="text-sm text-red-400 hover:text-red-300 px-3 py-1 rounded-md border border-red-400/20 transition">
          Disconnect
        </button>
      </div>
    </div>
  </header>
  <div class="pt-20"></div>

  <!-- MAIN DASHBOARD -->
  <main class="max-w-7xl mx-auto px-6 mt-12 grid md:grid-cols-2 gap-10 items-center">
    <!-- Floating Island -->
    <div class="relative flex justify-center">
      <div id="islandWrap" class="relative">
        <img id="islandImg" src="images/floating-island.png" alt="Mining Island"
          class="w-full max-w-3xl mx-auto drop-shadow-[0_0_40px_rgba(34,211,238,0.3)] animate-float" />

        <div class="absolute -bottom-8 left-1/2 -translate-x-1/2 w-[60%] h-24 bg-cyan-400/30 blur-3xl rounded-full"></div>

        <div id="miningStatus"
          class="absolute bottom-8 left-1/2 -translate-x-1/2 text-cyan-300 text-sm font-semibold bg-black/60 px-4 py-2 rounded-full shadow-lg hidden">
          ‚õèÔ∏è Mining in progress...
        </div>

        <div class="sparkle sparkle1"></div>
        <div class="sparkle sparkle2"></div>
        <div class="sparkle sparkle3"></div>
        <div class="sparkle sparkle4"></div>
      </div>
    </div>

    <!-- Mining Control Panel -->
    <div class="bg-slate-800/60 rounded-2xl p-8 shadow-2xl border border-white/10 backdrop-blur-sm">
      <h2 class="text-2xl font-bold text-cyan-400 mb-6 text-center">Mining Control Panel</h2>

      <button id="startMiningBtn"
        class="w-full py-3 bg-gradient-to-r from-cyan-400 to-blue-500 text-black font-bold rounded-lg shadow-md hover:scale-105 transition-transform duration-300">
        Start Mining
      </button>

      <div class="mt-6 space-y-4">
        <div>
          <p class="text-sm text-gray-400">CURRENT MINING RATE</p>
          <p id="miningRate" class="text-2xl font-bold text-cyan-300">0.00 $DIA / min</p>
        </div>
        <div>
          <p class="text-sm text-gray-400">MINING BALANCE</p>
          <p id="miningBalance" class="text-2xl font-bold text-cyan-300">0.00 $DIA</p>
        </div>
      </div>

      <button id="claimBtn"
        class="mt-8 w-full py-3 bg-gradient-to-r from-green-400 to-emerald-500 text-black font-bold rounded-lg shadow-md hover:scale-105 transition-transform duration-300">
        Claim Rewards
      </button>
    </div>
  </main>

  <!-- WALLET MODAL -->
  <div id="walletModal" class="fixed inset-0 flex items-center justify-center bg-black/70 hidden z-50">
    <div class="bg-gray-900 p-8 rounded-2xl text-center shadow-2xl border border-cyan-400/40 w-[90%] max-w-sm">
      <h2 class="text-2xl font-bold text-cyan-400 mb-4">Connect Your Wallet</h2>
      <p class="text-gray-300 mb-6 text-sm">
        Please connect your Solana wallet to start mining $DIA tokens.
      </p>
      <button id="connectWalletBtn"
        class="w-full py-3 bg-gradient-to-r from-cyan-400 to-blue-500 text-black font-bold rounded-lg shadow-md hover:scale-105 transition-transform duration-300">
        Connect Wallet
      </button>
      <button onclick="closeWalletModal()" class="mt-4 text-gray-400 hover:text-cyan-300 text-sm">
        Cancel
      </button>
    </div>
  </div>

  <footer class="text-center py-6 text-xs text-slate-500 mt-10">
    ¬© 2025 DiamondMiner ‚Äî All Rights Reserved.
  </footer>

  <!-- JS LOGIC -->
  <script>
    // ---------- utils & DOM elements ----------
    const startBtn = document.getElementById("startMiningBtn");
    const miningStatus = document.getElementById("miningStatus");
    const miningRateEl = document.getElementById("miningRate");
    const miningBalanceEl = document.getElementById("miningBalance");
    const disconnectBtn = document.getElementById("disconnectBtn");
    const connectWalletBtn = document.getElementById("connectWalletBtn");
    const walletModal = document.getElementById("walletModal");
    const islandImg = document.getElementById("islandImg");
    const sparkles = Array.from(document.querySelectorAll(".sparkle"));

    // ---------- check wallet on load ----------
    document.addEventListener("DOMContentLoaded", () => {
      // If no wallet stored, redirect to home (fade out)
      const wallet = localStorage.getItem("walletAddress");
      if (!wallet) {
        document.body.classList.remove("fade-in");
        document.body.classList.add("fade-out");
        setTimeout(() => { window.location.href = "index.html"; }, 600);
        return;
      }
      // if wallet present, keep the page (optionally show a small indicator)
      // you can show the short address somewhere if desired
    });

    // ---------- wallet modal helpers ----------
    function openWalletModal() { walletModal.classList.remove("hidden"); }
    function closeWalletModal() { walletModal.classList.add("hidden"); }

    // ---------- connect wallet (Phantom) ----------
    async function connectWallet() {
      if (window.solana && window.solana.isPhantom) {
        try {
          const resp = await window.solana.connect();
          const addr = resp.publicKey.toString();
          localStorage.setItem("walletAddress", addr);
          closeWalletModal();
          alert("‚úÖ Wallet connected: " + addr);
          // stay on dashboard if connected via modal
        } catch (err) {
          console.error("Wallet connection cancelled:", err);
        }
      } else {
        alert("‚ö†Ô∏è Phantom wallet not found. Please install it from https://phantom.app/");
      }
    }
    connectWalletBtn.addEventListener("click", connectWallet);

    // ---------- mining logic + sparkle toggle ----------
    let mining = false;
    let balance = 0;
    let rate = 0.05; // $DIA per minute
    let miningInterval = null;

    function setSparklesActive(active) {
      if (active) {
        sparkles.forEach(s => s.classList.add("sparkle-active"));
        islandImg.classList.add("island-glow");
      } else {
        sparkles.forEach(s => s.classList.remove("sparkle-active"));
        islandImg.classList.remove("island-glow");
      }
    }

    startBtn.addEventListener("click", () => {
      const wallet = localStorage.getItem("walletAddress");
      if (!wallet) {
        // open modal if not connected (shouldn't happen due to on-load redirect but safe)
        openWalletModal();
        return;
      }

      mining = !mining;
      if (mining) {
        startBtn.innerText = "Stop Mining";
        miningStatus.classList.remove("hidden");
        setSparklesActive(true);

        miningInterval = setInterval(() => {
          // Add per-second accrual based on rate per minute
          balance += (rate / 60);
          miningBalanceEl.innerText = balance.toFixed(2) + " $DIA";
          miningRateEl.innerText = rate.toFixed(2) + " $DIA / min";
        }, 1000);
      } else {
        startBtn.innerText = "Start Mining";
        miningStatus.classList.add("hidden");
        setSparklesActive(false);
        clearInterval(miningInterval);
      }
    });

    // ---------- claim ----------
    document.getElementById("claimBtn").addEventListener("click", () => {
      if (balance > 0) {
        alert("üíé You claimed " + balance.toFixed(2) + " $DIA!");
        balance = 0;
        miningBalanceEl.innerText = "0.00 $DIA";
      } else {
        alert("‚ö†Ô∏è No rewards to claim yet!");
      }
    });

    // ---------- disconnect ----------
    disconnectBtn.addEventListener("click", () => {
      localStorage.removeItem("walletAddress");
      // fade out then go back to home
      document.body.classList.remove("fade-in");
      document.body.classList.add("fade-out");
      setTimeout(() => { window.location.href = "index.html"; }, 600);
    });

    // Safety: if user disconnects in another tab, keep UI in sync
    window.addEventListener('storage', (e) => {
      if (e.key === 'walletAddress' && e.newValue === null) {
        // redirect back to home if wallet removed elsewhere
        document.body.classList.remove("fade-in");
        document.body.classList.add("fade-out");
        setTimeout(() => { window.location.href = "index.html"; }, 600);
      }
    });
  </script>
</body>
</html>
